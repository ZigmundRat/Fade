<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<style type="text/css">
.auto-style1 {
	margin-left: 40px;
}
.auto-style2 {
	margin-left: 80px;
}
</style>
</head>

<body>

<h1>Fade Language Reference</h1>
<h2>Variables</h2>
<p>Variable names can be any combination of alpha, numeric, and underscore 
characters, except for those reserved by the language. The first character 
cannot be a number.</p>
<p>Variables are locally scoped within a specific function.</p>
<p>&nbsp;</p>
<h2>&nbsp;</h2>
<h2>Values</h2>
<p>There are four types of values in Fade. All typing is implicit and determined 
by usage. </p>
<h4>Integers</h4>
<p>integers are 4-byte integer values.</p>
<p>Example:</p>
<p class="auto-style1">345</p>
<h4>Floats</h4>
<p>Floats are 4-byte floating-point values</p>
<p>Example:</p>
<p class="auto-style1">13.13</p>
<h4>Strings</h4>
<p>Strings are sequences of characters with opening and closing double-quotes.</p>
<p>Example:</p>
<p class="auto-style1">"Here is some text"</p>
<h4>Arrays</h4>
<p>All integer or float values are implemented as single-valued arrays. Indexes 
are zero-based.</p>
<p>An array of values can be defined as a constant:</p>
<p class="auto-style1">a = {1, 2, 3}</p>
<p>or can be created using array references:</p>
<p class="auto-style1">a[0] = 1<br />
a[1] = 2<br />
a[2] = 3</p>
<p>&nbsp;</p>
<h2>Expressions and Operators</h2>
<p>Expressions and operators use a "C-style" syntax.</p>
<p>The following operators are supported, in order of precedance:</p>
<table style="width: 53%">
	<tr>
		<td style="width: 141px"><strong>Operator</strong></td>
		<td style="width: 501px"><strong>Description</strong></td>
		<td style="width: 551px"><strong>Example</strong></td>
	</tr>
	<tr>
		<td style="width: 141px">MyFunc(...)</td>
		<td style="width: 501px">Function call</td>
		<td style="width: 551px">GetValue(1, b)</td>
	</tr>
	<tr>
		<td style="width: 141px">[]</td>
		<td style="width: 501px">Array reference</td>
		<td style="width: 551px">val[33]</td>
	</tr>
	<tr>
		<td style="width: 141px">()</td>
		<td style="width: 501px">Parentheses</td>
		<td style="width: 551px">(x + 5) * 2</td>
	</tr>
	<tr>
		<td style="width: 141px">+, -</td>
		<td style="width: 501px">Unary plus or minus</td>
		<td style="width: 551px">+33, -15.5</td>
	</tr>
	<tr>
		<td style="width: 141px">*, /, %</td>
		<td style="width: 501px">Binary multiplication, division, and modulus</td>
		<td style="width: 551px">15 * 35</td>
	</tr>
	<tr>
		<td style="width: 141px">+, -</td>
		<td style="width: 501px">Binary plus or minus</td>
		<td style="width: 551px">x + 128</td>
	</tr>
	<tr>
		<td style="width: 141px">&lt;, &lt;=, &gt;, &gt;=</td>
		<td style="width: 501px">Relational</td>
		<td style="width: 551px">q &gt; 55</td>
	</tr>
	<tr>
		<td style="width: 141px">==, !=</td>
		<td style="width: 501px">Equality and inequality</td>
		<td style="width: 551px">value == 1</td>
	</tr>
	<tr>
		<td style="width: 141px">&amp;&amp;</td>
		<td style="width: 501px">Logical AND</td>
		<td style="width: 551px">value == 15 &amp;&amp; test &gt; 0</td>
	</tr>
	<tr>
		<td style="width: 141px">||</td>
		<td style="width: 501px">Logical OR</td>
		<td style="width: 551px">value == 10 || debug != 0</td>
	</tr>
	<tr>
		<td style="width: 141px">=</td>
		<td style="width: 501px">Assignment</td>
		<td style="width: 551px">result = 15 * (35 + a)</td>
	</tr>
</table>
<p>&nbsp;</p>
<h2>Statements</h2>
<h3>FOR / ENDFOR</h3>
<p>Implements a loop.</p>
<p>FOR &lt;variable&gt; &lt;first&gt;:&lt;last&gt;[:&lt;increment&gt;]</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">variable</td>
		<td style="width: 1094px">The counter variable for the loop</td>
	</tr>
	<tr>
		<td style="width: 332px">first</td>
		<td style="width: 1094px">The value for the first iteration of the loop</td>
	</tr>
	<tr>
		<td style="width: 332px">last</td>
		<td style="width: 1094px">The value of the last iteration of the loop</td>
	</tr>
	<tr>
		<td style="width: 332px; height: 17px">increment</td>
		<td style="width: 1094px; height: 17px">The increment of the counter 
		variable each iteration. Will be 1 if it is omitted. </td>
	</tr>
</table>
<p>The for loop will execute, starting with the first value and terminating when 
the value exceeds the last value. The increment is 1 if not specified.</p>
<p>Example:</p>
<p class="auto-style1">&nbsp;FOR channel 32:1:-1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DI(1,channel,{red, green, blue})<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D(10,channel,{0, 0, 0})<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A(3)<br />
ENDFOR </p>
<h3>IF / ELSEIF / ELSE ENDIF</h3>
<p>IF &lt;condition&gt;</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">condition</td>
		<td style="width: 1094px">The condition to evaluate. Zero (0) is false, 
		any non-zero value is true.</td>
	</tr>
</table>
<p>&nbsp;Implements a condition statement. </p>
<p>Example:</p>
<p class="auto-style1">IF x == 1<br />
&nbsp;&nbsp;&nbsp;&nbsp; PL("one")<br />
ELSEIF x== 2<br />
&nbsp;&nbsp;&nbsp;&nbsp; PL("two")<br />
ELSE<br />
&nbsp;&nbsp;&nbsp;&nbsp; PL("other")<br />
ENDIF</p>
<p>&nbsp;</p>
<h3>Assignment</h3>
<p>Assignment is technically an operator, but is listed here for completeness.
</p>
<p>&lt;variable or array reference&gt; = &lt;value&gt;</p>
<p>Examples: </p>
<p class="auto-style1">x = y * y</p>
<p class="auto-style1">g[x] = 33</p>
<h3>Break</h3>
<p>Breaks out of a FOR loop and continues execution in the next statement after 
the ENDFOR</p>
<h3>Return</h3>
<p>Returns a value from a function.</p>
<p>Example:</p>
<p class="auto-style1">RETURN result</p>
<h2>Functions</h2>
<p>Functions may be defined and called:</p>
<h3>Function Definition (FUNC/ENDFUNC)</h3>
<p>FUNC &lt;name&gt;(&lt;parameterList&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">name</td>
		<td style="width: 1094px">The name of the function</td>
	</tr>
	<tr>
		<td style="width: 332px">parameterList</td>
		<td style="width: 1094px">A list of zero or more parameters</td>
	</tr>
</table>
<p>Declares a function.</p>
<p>Example:</p>
<p class="auto-style1">FUNC GetColor(colorNumber)<br />
<br />
IF (colorNumber == 0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN {1, 0, 0}<br />
ELSEIF (colorNumber == 1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN {1, 1, 0}<br />
ELSEIF (colorNumber == 2)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURN {0, 1, 0}<br />
ENDIF<br />
<br />
ENDFUNC</p>
<h3>Function Invocation</h3>
<p>Call a function.</p>
<p>Example:</p>
<p class="auto-style1">color = GetColor(x)</p>
<h2>Built In Functions</h2>
<h4>A</h4>
<p>Perform the animation for a given number of cycles. </p>
<p>A(&lt;cycleCount&gt;)<br />
</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int cycleCount</td>
		<td style="width: 1094px">The number of cycles to animate</td>
	</tr>
</table>
<p>The A() function drives the led hardware to perform all currently defined 
animations for the specified number of cycles.</p>
<p>Once a fade is completed, that led channel will remain at the final 
brightness value until a new fade for that channel is defined and executed. If 
there are no defined animations, calling the A() function merely delay by the 
specified cycle count.</p>
<h4>&nbsp;</h4>
<h4>CONFIGBUTTON</h4>
<p>CONFIGBUTTON defines a button that can be used to control program flow.</p>
<p>CONFIGBUTTON(&lt;buttonNumber&gt;, &lt;buttonType&gt;, &lt;buttonPin&gt;, &lt;param 1&gt;, &lt;param 2&gt;, 
&lt;param 3&gt; , &lt;param 4&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int buttonNumber</td>
		<td style="width: 1094px">The number of this button, from 0 to 9</td>
	</tr>
	<tr>
		<td style="width: 332px">string buttonType</td>
		<td style="width: 1094px">The physical hardware type of the button.</td>
	</tr>
	<tr>
		<td style="width: 332px">int buttonPin</td>
		<td style="width: 1094px">The physical pin to use for the button.</td>
	</tr>
	<tr>
		<td style="width: 332px">int param</td>
		<td style="width: 1094px">A parameter specific to the button type</td>
	</tr>
</table>
<p>The following table defines the supported button types:</p>
<table class="auto-style1" style="width: 90%">
	<tbody class="auto-style2">
		<tr>
			<td style="width: 138px">"TOUCH"</td>
			<td>A touch button implemented using the ESP32's built-in touch 
			support. The param parameter defines the touch threshold used to 
			determine whether the contact is touched or not</td>
		</tr>
</table>
<p>See READBUTTON() to read button values. For touch buttons, see 
DEBUG("DebugButtonNumber") to determine an appropriate threshold value. </p>
<p>Examples:</p>
<p>CONFIGBUTTON(0, "TOUCH", 15, 20)</p>
<p>Defines a touch button connected to pin 15 of the ESP32 and use 20 as the 
touch threshold value. </p>
<p>&nbsp;</p>
<h4>CONFIGLED</h4>
<p>CONFIGLED defines one or more LEDs that the system can animate.</p>
<p>CONFIGLED(&lt;ledStringNumber&gt;, &lt;ledStringType&gt;, &lt;ledCount&gt;, &lt;param 1&gt;, &lt;param 
2&gt;, &lt;param 3&gt; , &lt;param 4&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int ledStringNumber</td>
		<td style="width: 1094px">The number of this string. Fade supports up to 
		16 led strings. They must be defined sequentially, starting with string 
		number zero. </td>
	</tr>
	<tr>
		<td style="width: 332px">string ledStringType</td>
		<td style="width: 1094px">The physical hardware type of the string.</td>
	</tr>
	<tr>
		<td style="width: 332px">int ledCount</td>
		<td style="width: 1094px">The number of leds in the string</td>
	</tr>
	<tr>
		<td style="width: 332px">int param</td>
		<td style="width: 1094px">Parameters specific to the physical hardware 
		type of the string</td>
	</tr>
</table>
<p>The following table defines the supported string types:</p>
<table class="auto-style1" style="width: 90%">
	<tbody class="auto-style2">
		<tr>
			<td style="width: 138px">"RGB"</td>
			<td>A string of WS2812-compatible (aka "neopixel") addressable leds. 
			The &lt;ledCount&gt; parameter defines the number of leds on the string, 
			and &lt;param 1&gt; defines the physical pin the strip is connected to.</td>
		</tr>
		<tr>
			<td style="width: 138px">"PWM"</td>
			<td>A non-addressable LED controlled through PWM. This feature uses 
			the ESP-32's built in LED control hardware. 1-4 leds can be defined 
			in a single statement, and the physical pins are defined using 
			parameters 1-4.</td>
		</tr>
</table>
<p>Examples:</p>
<p>CONFIGLED(0, "RGB", 8, 27)<br />
CONFIGLED(1, "PWM", 3, 17, 16, 4)</p>
<p>Configures a string of 8 WS2812 leds connected to pin 27 as the first string, 
followed by 3 individually controlled PWM leds on pins 17, 16, and 4. </p>
<p>When animating, leds 0-7 will be the WS2812 leds and leds 8-10 will be the 
PWM ones. </p>
<h4>D and DI</h4>
<p>D and DI define a fade for the animation system to perform.</p>
<p>D(&lt;cycleCount&gt;, &lt;ledIndex&gt;, &lt;targetBrightness&gt;)<br />
DI(&lt;cycleCount&gt;, &lt;ledIndex&gt;, &lt;targetBrightness&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int cycleCount</td>
		<td style="width: 1094px">The number of animation cycles over which to 
		perform the fade</td>
	</tr>
	<tr>
		<td style="width: 332px">int ledIndex</td>
		<td style="width: 1094px">The index of the led to animate. Led indexes 
		run from zero to n-1, where n is the number of LEDs defined across all 
		led groups.</td>
	</tr>
	<tr>
		<td style="width: 332px">brightness targetBrightness</td>
		<td style="width: 1094px">The target brightness for the led</td>
	</tr>
</table>
<p>The cycleCount parameter is used to control how fast the fade occurs, 
expressed in 10 millisecond units. </p>
<p>The targetBrightnessparameter defines the target brightness, and the format 
depends upon the type of underlying LED hardware. For PWM leds, it is a single 
floating point value. For addressable LEDs, it is a series of values. </p>
<p>The DI function is used to simplify code when only a single fade operation is 
required by also performing the animation; it is equivalent to:</p>
<p>D(&lt;cycleCount&gt;, &lt;ledIndex&gt;, &lt;targetBrightness&gt;)<br />
A(&lt;cycleCount&gt;)</p>
<p>Examples:</p>
<p>D(100, 3, 1.0)</p>
<p>Define a fade led #3 to full brightness over the next 100 cycles (1 second)</p>
<p>D(30, 5, {1.0, 0.0, 0.0})<br />
D(30, 6, {0.0, 0.5, 0.0})<br />
<br />
Define two fades that will occur over the next 30 cycles; led #5 will fade to 
red and led #6 will fade to 50% green.</p>
<h4>DEBUG</h4>
<p>DEBUG sets a debugging flag.</p>
<p>DEBUG (&lt;debugFlag&gt;, &lt;value&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">string debugFlag</td>
		<td style="width: 1094px">The debug flag to set</td>
	</tr>
	<tr>
		<td style="width: 332px">int value</td>
		<td style="width: 1094px">The value to set for the flag</td>
	</tr>
</table>
<p>The Fade animation system provides debug flags that can make understanding 
system behavior easier. The following debug flags are defined</p>
<table class="auto-style1" style="width: 90%">
	<tbody class="auto-style2">
		<tr>
			<td style="width: 273px">"LogStatements"</td>
			<td>Every statement that is executed will be logged to the Serial 
			console.</td>
		</tr>
		<tr>
			<td style="width: 273px">"LogHeapFreeOnAllocation"&nbsp; </td>
			<td>The amount of free heap memory is logged when allocations are 
			performed.</td>
		</tr>
		<tr>
			<td style="width: 273px">"DebugButtonNumber"</td>
			<td>Logs the current button touch value whenever the button value is 
			read. Used to determine an appropriate threshold number</td>
		</tr>
</table>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h4>P<br />
PL</h4>
<p>Prints a diagnostic value to the serial subsystem&nbsp; </p>
<p>P(&lt;value&gt;,...)<br />
PL(&lt;value&gt;,...)<br />
</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">value</td>
		<td style="width: 1094px">A string, integer, or brightness value </td>
	</tr>
</table>
<p>PL performs the print operation followed by a new line. </p>
<h4>RAND</h4>
<p>RAND generates a pseudo-random number between the minimum and maximum value, 
inclusive.</p>
<p>RAND(&lt;minimumValue&gt;, &lt;maximumValue&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int minimumValue</td>
		<td style="width: 1094px">The smallest number to generate</td>
	</tr>
	<tr>
		<td style="width: 332px">int maximumValue</td>
		<td style="width: 1094px">The largest number to generate</td>
	</tr>
</table>
<h4>READBUTTON</h4>
<p>READBUTTON reads the current value of a button to determine if it is pressed.</p>
<p>int READBUTTON(&lt;buttonNumber&gt;)</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int buttonNumber</td>
		<td style="width: 1094px">The number of this button, from 0 to 9</td>
	</tr>
</table>
<p>This function returns 1 if the button is pressed and 0 if the button is not 
pressed.</p>
<p>Examples:</p>
<p>IF READBUTTON(0) == 1<br />
<br />
ENDIF</p>
<h4>S and SI</h4>
<p>S and SI define a fade for the animation system to perform for multiple leds.
</p>
<p>S(&lt;cycleCount&gt;, &lt;firstLedTargetBrightness&gt;, ..., &lt;lastLedTargetBrightness&gt;)<br />
SI(&lt;cycleCount&gt;, &lt;firstLedTargetBrightness&gt;, ..., &lt;lastLedTargetBrightness&gt;)<br />
</p>
<table class="auto-style1" style="width: 70%">
	<tr>
		<td style="width: 332px">int cycleCount</td>
		<td style="width: 1094px">The number of animation cycles over which to 
		perform the fade</td>
	</tr>
	<tr>
		<td style="width: 332px">target brightness list</td>
		<td style="width: 1094px">A list of target brightnesses for the leds</td>
	</tr>
</table>
<p>The S and SI functions are used to define a fade that is performed on 
multiple LEDs using the same cycle count.</p>
<p>The cycleCount parameter is used to control how fast the fade occurs, 
expressed in 10 millisecond units. </p>
<p>The target brightness list defines the target brightness for the leds, 
starting with led #0 and continuing based on the number of values listed</p>
<p>The SI function is used to simplify code when only a single fade operation is 
required by also performing the animation. See DI for more information.</p>
<p>Examples:</p>
<p>S(100, 1.0)</p>
<p>Define a fade for led #0 to full brightness over one second.</p>
<p>SI(200, {1.0, 0.0, 0.0}, {0.0, 1.0, 0.0}, {0.0, 0.0, 1.0} )<br />
<br />
Define three fades that will occur over the next 200 cycles; led #0 will fade to 
red, #1 to green, and #2 to blue. This is equivalent to:<br />
<br />
D(200, 0, {1.0, 0.0, 0.0})<br />
D(200, 1, {0.0, 1.0, 0.0})<br />
D(200, 2, {0.0, 0.0, 1.0} )<br />
A(200)<br />
</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

</body>

</html>
